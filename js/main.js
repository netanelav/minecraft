let minecraft = {
  blocks: {
    sky: { type: "sky", tool: "none" },
    cloud: { type: "cloud", tool: "cloudTool" },
    dirt: { type: "dirt", tool: "shovel" },
    grass: { type: "grass", tool: "shovel" },
    leaf: { type: "leaf", tool: "axe" },
    tree: { type: "tree", tool: "axe" },
    rock: { type: "rock", tool: "pickaxe" }
  },

  matrix: [
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "cloud",
      "cloud",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "cloud",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "cloud",
      "cloud",
      "cloud",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "tree",
      "tree",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "tree",
      "tree",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "tree",
      "tree",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky"
    ],
    [
      "sky",
      "sky",
      "sky",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "leaf",
      "sky",
      "sky",
      "sky",
      "sky",
      "sky",
      "rock",
      "rock",
      "rock",
      "rock",
      "sky",
      "sky",
      "sky",
      "sky",
      "tree",
      "tree",
      "sky",
      "sky",
      "sky",
      "rock",
      "rock"
    ],
    [
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass",
      "grass"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ],
    [
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt",
      "dirt"
    ]
  ]
};

minecraft.createBoard = function() {
  var gameBoard = $("#gameBoard");

  for (var i = 0; i < minecraft.matrix.length; i++) {
    var newRow = document.createElement("div");
    newRow.classList.add("blocks-row");
    newRow.setAttribute("width", "100%");
    gameBoard.append(newRow);

    for (var j = 0; j < minecraft.matrix[i].length; j++) {
      var newBlock = document.createElement("span");
      newBlock.classList.add("block");
      newBlock.setAttribute(
        "block-type",
        minecraft.blocks[minecraft.matrix[i][j]].type
      );
      newBlock.setAttribute(
        "tool",
        minecraft.blocks[minecraft.matrix[i][j]].tool
      );
      newRow.append(newBlock);
    }
  }
};

minecraft.createBoard();
minecraft.blockInStack;
minecraft.currentTool = "pickaxe";
$("#pickaxe").addClass("blueBorder");

minecraft.chooseTool = function(e) {
  console.log("func started");
  if (minecraft.currentTool === "stack") {
    $(minecraft.blockInStack).removeClass("blueBorder");
  } else {
    $(`#${minecraft.currentTool}`).removeClass("blueBorder");
  }

  if (e.target.getAttribute("inStack") === "yes") {
    console.log("enters here");
    currentTool = "stack";
    blockInStack = e.target;
    $(e.target).addClass("blueBorder");
  } else {
    minecraft.currentTool = e.target.id;
    $(`#${minecraft.currentTool}`).addClass("blueBorder");
  }
};
$(".tool").click(minecraft.chooseTool);


minecraft.chooseInWorldBlock = function(e) {
  function updateBlockStack(type) {
    if ($("#stack").children().length >= 6) {
      $("#stack span").last().remove();
    }
    var newStackItem = document.createElement("span");
    newStackItem.classList.add("stackItem", "m-0", "p-0");
    newStackItem.setAttribute("inStack", "yes");
    newStackItem.setAttribute("block-type", `${type}`);
    $(newStackItem).click(minecraft.chooseTool);
    $("#stack").prepend(newStackItem);
  }

  let type = $(e.target).attr("block-type");

  if (minecraft.currentTool === "stack") {
    console.log("tool=stack");
    if (document.getElementById("stack").getAttribute("block-type") !== "sky") {
      let stackType = document
        .getElementById("stack")
        .getAttribute("block-type");
      if (stackType !== "sky") {
        e.target.setAttribute("block-type", stackType);
        document.getElementById("stack").setAttribute("block-type", "sky");
        $("#stack").removeClass("blueBorder");
      } //stack: just the block should flash red
    }
  } else if (minecraft.blocks[type].tool === minecraft.currentTool) {
    $(e.target).attr("block-type", "sky");
    updateBlockStack(type);
  } else {
    minecraft.toolFlashRed(minecraft.currentTool);
  }
};

$(".block").click(minecraft.chooseInWorldBlock);

minecraft.toolFlashRed = function(currentTool) {
  $(`#${currentTool}`).removeClass("blueBorder");
  $(`#${currentTool}`).addClass("redBorder");
  setTimeout(() => {
    $(`#${currentTool}`).addClass("blueBorder");
    $(`#${currentTool}`).removeClass("redBorder");
  }, 400);
};
